#!/bin/sh

clear

echo "Created for Auchan Retail by afrantsev@auchan.ua __ 2021"
echo " "

echo "MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM"
echo "MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM"
echo "MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM"
echo "MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWWWWWWWWWWWWWWWWWWWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM"
echo "MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMXxlooooooooooooooooo0MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM"
echo "MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNx;;;;;;;;;;;;;;;;;;;oXMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM"
echo "MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWO:;;;;;;;;lxc;;;;;;;;cOWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM"
echo "MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMKl;;;;;;;;:kWk;;;;:looodxxxOKNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM"
echo "MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNd;;;;;;;;;oNMXo;;cxxl:;;;;:c:lkNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM"
echo "MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWO:;;;;;;;;c0MMMO::xd::;;;:cdd:;:lxxkOXWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM"
echo "MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMKl;;;;;;;;;xWMMMNkddl:;;;;;:::;;;lk00KXWWWWWWMMMMMMMMMWWWWWWWMMMMMMMMMMWWWWWWWWMMMMMMMMMWNXXXXXXXNWMMMMMMMMMMMWWWWWWWMMMMMMMMMMWWWWWWWWMMMMMMMMMMMMMMMMMMM"
echo "MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNd;;;;;;;;;lXMNKkdl:;;;;;;;;;;;;;lKMMKdoooooooxXMMMMMMKdooooooxNMMMMMMMKdoooooodKMMMWKkxdolc:::::cloxOKWMMMMMXxoooooookNMMMMMMNkooooooodKMMMMMMMMMMMMMMMMMM"
echo "MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWOc::::::::lk0xoc:;;;;;;;;;;;;;;;;kWMMO:;;;;;;,lKMMMMMMO:;;;;;,lXMMMMMMMO:;;;;;;:0MMMXo,;;;;;;;;;;;;;;;:o0WMMM0c,;;;;;,lXMMMMMMNo,;;;;;;:OMMMMMMMMMMMMMMMMMM"
echo "MMMMMMMMMMMMMMMMMMMMMMMMMMMMXOOOOOkxooooooooddoc::;;;;;;;;;;;;;;;;;lKMMMO:;;;;;;,lKMMMMMMO:;;;;;,lXMMMMMMMO:;;;;;;:0MMMXl,;;:clllc:;;;;;;;;:xNMM0c,;;;;;,lXMMMMMMNo;;;;;;;:OMMMMMMMMMMMMMMMMMM"
echo "MMMMMMMMMMMMMMMMMMMMMMMMMMMMNOoc:::::::::::::::;;;;;;;;;;;;;;;;;;;:OWMMMO:;;;;;;,lKMMMMMMO:;;;;;,lXMMMMMMMO:;;;;;;:0MMMXxdk0XNNWWNX0o;;;;;;;:OMM0c,;;;;;,lXMMMMMMNo;;;;;;;:OMMMMMMMMMMMMMMMMMM"
echo "MMMMMMMMMMMMMMMMMMMMMMMMMMMMXklc:::::::::::::;;;;;;;;;;;;;;;;;;;;cdkXMMMO:;;;;;;,lKMMMMMMO:;;;;;,lXMMMMMMMO:;;;;;;:0MMMMWWWXKK0OOOOOx:;;;;;;;xWM0c,;;;;;,lXMMMMMMXo;;;;;;;:0MMMMMMMMMMMMMMMMMM"
echo "MMMMMMMMMMMMMMMMMMMMMMMMMMMMNK00koodkdc::::::::::::::::;;;;;;;;:oxl;xWMMO:;;;;;;,lKMMMMMMO:;;;;;,lXMMMMMMMO:;;;;;;:0MMWXOdlc:;;;;;;;;;;;;;;;;dWM0c,;;;;;;:looooooo:;;;;;;;:0MMMMMMMMMMMMMMMMMM"
echo "MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMXo;;dOxoddddddddddddl::;;;;;;:lodo:;;:OMMO:;;;;;;,lKMMMMMMO:;;;;;,lXMMMMMMWk;;;;;;;:0MNkc;;;;;;;;;::::;;;;;;;;dNM0c,;;;;;;;;;;;;;;;;;;;;;;;:0MMMMMMMMMMMMMMMMMM"
echo "MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWx;;;clllllo0WMMMMMMWOc::cl::lxdc;;;;;;lXMO:;;;;;;;:0MMMMMXo;;;;;;;c0MMMMMMXl;;;;;;,:0Wx;;;;;;;;ok0KKKOc;;;;;;;dNM0c,;;;;;;;:ccccccc:;;;;;;;:0MMMMMMMMMMMMMMMMMM"
echo "MMMMMMMMMMMMMMMMMMMMMMMMMMMMMM0c;;;;;;;;;oXMMMMMMMMNd:lOXx:lxl;;;;;;;;xN0:;;;;;;;;lOXXXOl;;;;;;;;;l0XXXXOl;;;;;;;;:0Xl,;;;;;;lKMMMMNk:;;;;;;;dNM0c,;;;;;;l0XXNNXXKo;;;;;;;:0MMMMMMMMMMMMMMMMMM"
echo "MMMMMMMMMMMMMMMMMMMMMMMMMMMMMXo;;;;;;;;;:OMMMMMMMMMM0l:xNKl:dx:;;;;;;;:OXo;;;;;;;;;;:c:;;;;;;;;;;;;;::c:;;;;;;;;;,:0No;;;;;;;:oO0Oko:;;;;;;;;dNMKc,;;;;;,lXMMMMMMNo;;;;;;;:0MMMMMMMMMMMMMMMMMM"
echo "MMMMMMMMMMMMMMMMMMMMMMMMMMMMNx;;;;;;;;;;xNMMMMMMMMMMWk:cOWkccxo;;;;;;;;lKKl;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;:0M0l;;;;;;;;;;;;;;;;;;;;;;oNMKc,;;;;;,lXMMMMMMNo;;;;;;;:0MMMMMMMMMMMMMMMMMM"
echo "MMMMMMMMMMMMMMMMMMMMMMMMMMMWO:,;;;;;;;,lKMMMMMMMMMMMMXo:oXXd:oxc,;;;;;;;dNXxl:;;;;;;;;;coO0xc;;;;;;;;;;;cdkl,;;;;,:0MMXkl:;;;;;;;;:lxx:,;;;;,oXMKc,;;;;;,lXMMMMMMNo,;;;;;,:0MMMMMMMMMMMMMMMMMM"
echo "MMMMMMMMMMMMMMMMMMMMMMMMMMMW0xkkkkkkkkkKWMMMMMMMMMMMMWKkOXMXOOK0xkkkkkkxONMMNKOxddddxk0XWMMMNKOxdddddxk0XWW0xkkkkxkXMMMMNKOkxxxxkOKNMXkxkkkkx0NMNOxkkkkkx0NMMMMMMW0xkkkkkxkXMMMMMMMMMMMMMMMMMM"
echo "MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM"
echo "MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM"
echo "MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM"

echo " "

printf "Write Switch ip: "
read ip_sw  
printf "Write Last Switch ip: "
read last_sw

three_oktet=`echo "$ip_sw" | awk -F'.' '{print $1,$2,$3}' OFS='.'` 
four_oktet=`echo "$ip_sw" | sed -r 's/([0-9]{1,3}).([0-9]{1,3}).([0-9]{1,3}).([0-9]{1,3})/\4/'`
last_ip=`echo "$last_sw" | sed -r 's/([0-9]{1,3}).([0-9]{1,3}).([0-9]{1,3}).([0-9]{1,3})/\4/'`

$i=0;       
while true
do (
for out in `seq $four_oktet $last_ip`
do

	out_ip=$three_oktet'.'$out
	echo "$out_ip"

	
	(snmpwalk -v2c -m ALL -c merakiu $out_ip 1.3.6.1.4.1.9.9.656.1.4.1.1.10 | awk -F '"' '{print $2,$4,$6,$8,$10,$12,$14,$16,$18,$20,$22,$24,$26,$28,$30,$32,$34,$36,$38,$40,$42,$44,$46,$48}') >> mac.txt 

        vlan=`snmpwalk -v2c -O qv -m ALL -c merakiu $out_ip 1.3.6.1.4.1.9.9.656.1.4.1.1.14`
	   for v in $vlan; do (
		if [ "$v" = "*" ] ; then 
		echo "*"
		elif [ "$v" = "*" ]  ; then
		echo "Laptop"
		elif [ "$v" = "*" ]  ; then
                echo "MeDoc"
		elif [ "$v" = "*" ]  ; then
                echo "Badge"
		elif [ "$v" = "*" ]  ; then
                echo "BMS"
		elif [ "$v" = "*" ]  ; then
                echo "POS-160"
		elif [ "$v" = "*" ]  ; then
                echo "POS-161"
		elif [ "$v" = "*" ]  ; then
                echo "DRAC"
		elif [ "$v" = "*" ]  ; then
                echo "EPS"
		elif [ "$v" = "*" ]  ; then
                echo "VoIP"
		elif [ "$v" = "*" ]  ; then
                echo "PriceChecker-LAN"
		elif [ "$v" = "*" ]  ; then
                echo "Scale-LAN"
		elif [ "$v" = "*" ]  ; then
                echo "Security"
		elif [ "$v" = "*" ]  ; then
                echo "TAX"
		elif [ "$v" = "*" ]  ; then
                echo "UPS"
		elif [ "$v" = "*" ]  ; then
                echo "AP-WiFi"
		elif [ "$v" = "*" ]  ; then
                echo "PDA"
		elif [ "$v" = "*" ]  ; then
                echo "ST-WS"
		else
		echo $v
		fi ) >> vlan.txt
       	   done  
done )
	

i=$(($i+1))

if [ "$i" = "1" ] ; then
echo "ok"
	mv vlan.txt vlanf.txt
	mv mac.txt macf.txt
	paste -d ";" macf.txt vlanf.txt > outputf.txt
        sort -r outputf.txt > outputf1.txt
        rm outputf.txt

else
	echo "falce"
	paste -d ";" mac.txt vlan.txt > output.txt
	sort -r output.txt > output1.txt
	rm output.txt
	rm ./mac.txt
	rm ./vlan.txt
	diff outputf1.txt output1.txt >> new_mac.txt #TEST
	grep -vx outputf1.txt output1.txt | sort -u > out_mac.txt
fi
 	echo "######################################################### SLEEPING FOR 3500 SEC ######################################"
	sleep 3000
done


